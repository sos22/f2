#! /bin/bash

t=$(mktemp)

sha=$(git rev-parse HEAD)
cat > $t <<EOF
/* Auto-generated by mkgitversion; do not edit. */
#ifndef GITVERSION_H__
#define GITVERSION_H__

#define GITVERSION "$sha"

#endif /* !GITVERSION_H__ */
EOF

if ! [ -e gitversion.H ] || ! cmp -s gitversion.H $t
then
    echo "new gitversion"
    mv $t gitversion.H
fi
